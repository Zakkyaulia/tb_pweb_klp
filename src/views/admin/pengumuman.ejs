<%- include('../partials/admin-header', { title: 'Kelola Pengumuman' }) %>
<%- include('../partials/navbar') %>

<div class="relative flex-1 bg-green-800 p-10 min-h-screen text-white">
  <i class="fas fa-user-circle user-icon text-white text-3xl z-50 absolute top-10 right-10 cursor-pointer hover:text-green-100"></i>
  <div class="bg-white rounded-lg shadow-lg p-8 text-black mt-10">
  <div class="content-card bg-white rounded-xl shadow-lg p-8 animate-fade-in">
    <h2 class="text-xl font-bold text-gray-800 mb-4">Pengumuman</h2>
    <a href="/admin/pengumuman/add" class="bg-orange-600 px-3 py-1 rounded text-white mb-4 inline-block">
      <i class="fas fa-plus mr-1"></i>Tambah Pengumuman Baru
    </a>
    
    <table class="w-full text-black border border-gray-300">
      <thead class="bg-orange-600 text-white">
        <tr class="divide-x divide-gray-300 text-center">
          <th class="px-4 py-2 border-r border-gray-300">No</th>
          <th class="px-4 py-2 border-r border-gray-300 text-left">Judul</th>
          <th class="px-4 py-2 border-r border-gray-300">Tanggal</th>
          <th class="px-4 py-2">Aksi</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-300">
        <% if (data.length === 0) { %>
          <tr>
            <td colspan="4" class="text-center py-4">Belum ada pengumuman</td>
          </tr>
        <% } else { %>
          <% data.forEach((item, index) => { %>
            <tr class="text-center">
              <td class="px-4 py-2 border-r border-gray-200"><%= index + 1 %></td>
              <td class="px-4 py-2 border-r border-gray-200 text-left text-blue-600 underline cursor-pointer">
                 <a onclick="showPengumumanPreview('<%= item.judul.replace(/'/g, `\\'`) %>', `<%= item.isi.replace(/'/g, `\\'`).replace(/\\r?\\n/g, '<br>') %>`)"><%= item.judul %></a>
              </td>
              <td class="px-4 py-2 border-r border-gray-200"><%= new Date(item.tanggal_posting).toLocaleDateString('id-ID') %></td>
              <td class="px-4 py-2 space-x-2">
                <a href="/admin/pengumuman/edit/<%= item.id %>" class="text-blue-600 hover:text-blue-800" title="Edit">
                  <i class="fas fa-edit"></i>
                </a>
                <form action="/admin/pengumuman/delete/<%= item.id %>" method="POST" class="inline" onsubmit="confirmDelete(event, this)">
                  <button type="submit" class="text-red-600 hover:text-red-800" title="Hapus">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </form>
              </td>
            </tr>
          <% }) %>
        <% } %>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal Preview Pengumuman -->
<div id="previewModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50">
  <div class="bg-white p-6 rounded shadow-md w-1/2 max-w-lg text-left">
    <h3 id="previewModalTitle" class="text-lg font-semibold text-gray-800 mb-2"></h3>
    <hr class="my-2">
    <div id="previewModalContent" class="text-gray-700 mb-4" style="max-height: 60vh; overflow-y: auto;"></div>
    <div class="flex justify-end gap-4">
      <button onclick="closePreviewModal()" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Tutup</button>
    </div>
  </div>
</div>

<!-- Modal Konfirmasi Hapus -->
<div id="deleteModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50">
  <div class="bg-white p-6 rounded shadow-md w-80 text-center">
    <h3 class="text-lg font-semibold text-red-700 mb-2">Konfirmasi Hapus</h3>
    <p class="text-gray-700 mb-4">Apakah kamu yakin ingin menghapus pengumuman ini?</p>
    <div class="flex justify-center gap-4">
      <button onclick="cancelDelete()" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Batal</button>
      <button onclick="confirmDeleteSubmit()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Hapus</button>
    </div>
  </div>
</div>

<script>
    const previewModal = document.getElementById('previewModal');
    const previewModalTitle = document.getElementById('previewModalTitle');
    const previewModalContent = document.getElementById('previewModalContent');

    function showPengumumanPreview(judul, isi) {
        previewModalTitle.innerText = judul;
        previewModalContent.innerHTML = isi;
        previewModal.classList.remove('hidden');
    }

    function closePreviewModal() {
        previewModal.classList.add('hidden');
        previewModalTitle.innerText = '';
        previewModalContent.innerHTML = '';
    }
</script>

<%- include('../partials/admin-footer') %>
